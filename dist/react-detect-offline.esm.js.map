{"version":3,"file":"react-detect-offline.esm.js","sources":["../src/ConnectionContext.ts","../src/useConnection.ts","../src/Online.tsx","../src/Offline.tsx","../src/Detector.tsx","../src/ConnectionProvider.tsx"],"sourcesContent":["import React from 'react'\n\n/////////////////// Context ///////////////////////////\nexport interface ConnectionContextValue {\n  online?: boolean\n}\n\nexport const ConnectionContext = React.createContext<ConnectionContextValue>({ online: true })\n","import { ConnectionContext } from './ConnectionContext'\nimport { useContext } from 'react'\n\nexport function useConnection() {\n  return useContext(ConnectionContext)\n}\n","import { useEffect } from 'react'\nimport { useConnection } from './useConnection'\n\nexport interface OnlineProps {\n  children: JSX.Element\n  onChange?: (online: boolean) => any\n}\n\nexport default function Online({ children, onChange }: OnlineProps): JSX.Element {\n  const { online } = useConnection()\n\n  useEffect(() => {\n    if (onChange) {\n      onChange(online)\n    }\n  }, [online])\n\n  return online ? children : null\n}\n","import { useEffect } from 'react'\nimport { useConnection } from './useConnection'\n\nexport interface OfflineProps {\n  children: JSX.Element\n  onChange?: (online: boolean) => any\n}\n\nexport default function Offline({ children, onChange }: OfflineProps): JSX.Element {\n  const { online } = useConnection()\n\n  useEffect(() => {\n    if (onChange) {\n      onChange(online)\n    }\n  }, [online])\n\n  return !online ? children : null\n}\n","import { useEffect } from 'react'\nimport { useConnection } from './useConnection'\n\nexport interface DetectorProps {\n  children: (online: boolean) => JSX.Element\n  onChange?: (online: boolean) => any\n}\n\nexport default function Detector({ children, onChange }: DetectorProps) {\n  const { online } = useConnection()\n\n  useEffect(() => {\n    if (onChange) {\n      onChange(online)\n    }\n  }, [online])\n\n  if (children) {\n    return children(online)\n  }\n\n  return null\n}\n","import React, { useState, useEffect, useMemo } from 'react'\nimport { ConnectionContext } from './ConnectionContext'\n\nconst inBrowser = typeof navigator !== 'undefined'\n\n// these browsers don't fully support navigator.onLine, so we need to use a polling backup\nconst unsupportedUserAgentsPattern = /Windows.*Chrome|Windows.*Firefox|Linux.*Chrome/\n\nexport interface ConnectionProviderProps {\n  poll?: boolean\n  children: React.ReactNode\n}\n\nconst ConnectionProvider: React.FC<ConnectionProviderProps> = ({ poll = true, children }) => {\n  const [online, setOnline] = useState(inBrowser && typeof navigator.onLine === 'boolean' ? navigator.onLine : true)\n\n  useEffect(() => {\n    const goOnline = () => {\n      setOnline(true)\n    }\n    const goOffline = () => {\n      setOnline(false)\n    }\n    window.addEventListener('online', goOnline)\n    window.addEventListener('offline', goOffline)\n\n    return () => {\n      window.removeEventListener('online', goOnline)\n      window.removeEventListener('offline', goOffline)\n    }\n  }, [])\n\n  useEffect(() => {\n    const { enabled, interval, url, timeout } = getPollingConfig(poll)\n    let pollingId: NodeJS.Timeout = null\n\n    if (enabled) {\n      pollingId = setInterval(() => {\n        ping({ url, timeout }).then((result: boolean) => {\n          setOnline(result)\n        })\n      }, interval)\n    }\n\n    return () => {\n      if (pollingId) {\n        clearInterval(pollingId)\n      }\n    }\n  }, [poll])\n\n  const value = useMemo(() => ({ online }), [online])\n\n  return <ConnectionContext.Provider value={value}>{children}</ConnectionContext.Provider>\n}\n\nconst ping = ({ url, timeout }: { url: string; timeout: number }) => {\n  return new Promise(resolve => {\n    const isOnline = () => resolve(true)\n    const isOffline = () => resolve(false)\n\n    const xhr = new XMLHttpRequest()\n\n    xhr.onerror = isOffline\n    xhr.ontimeout = isOffline\n    xhr.onreadystatechange = () => {\n      if (xhr.readyState === xhr.HEADERS_RECEIVED) {\n        if (xhr.status) {\n          isOnline()\n        } else {\n          isOffline()\n        }\n      }\n    }\n\n    xhr.open('HEAD', url)\n    xhr.timeout = timeout\n    xhr.send()\n  })\n}\n\nconst getPollingConfig = (\n  polling: boolean\n): {\n  enabled?: boolean\n  url?: string\n  interval?: number\n  timeout?: number\n} => {\n  const defaultPollingConfig = {\n    enabled: inBrowser && unsupportedUserAgentsPattern.test(navigator.userAgent),\n    url: 'https://app.paintscout.com/api/',\n    timeout: 5000,\n    interval: 5000\n  }\n\n  switch (polling) {\n    case true:\n      return defaultPollingConfig\n    case false:\n      return { enabled: false }\n    default:\n      return Object.assign({}, defaultPollingConfig, polling)\n  }\n}\n\nexport default ConnectionProvider\n"],"names":["ConnectionContext","React","createContext","online","useConnection","useContext","Online","children","onChange","useEffect","Offline","Detector","inBrowser","navigator","unsupportedUserAgentsPattern","ConnectionProvider","poll","useState","onLine","setOnline","goOnline","goOffline","window","addEventListener","removeEventListener","getPollingConfig","enabled","interval","url","timeout","pollingId","setInterval","ping","then","result","clearInterval","value","useMemo","Provider","Promise","resolve","isOnline","isOffline","xhr","XMLHttpRequest","onerror","ontimeout","onreadystatechange","readyState","HEADERS_RECEIVED","status","open","send","polling","defaultPollingConfig","test","userAgent","Object","assign"],"mappings":"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"}